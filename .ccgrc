#!/bin/sh

###################################################
### Functions
###################################################

# append_path() and prepend_path() adapted from Fink's init.sh

# (If the shell supported a real list data structure instead
# of these stupid colon-delimited strings, none of this would be
# necessary. I wonder if there's a Python-based shell out there...)

# add to end of path
append_path()
{
    if eval test -z "\$$1"
    then
        eval "export $1=$2"
    fi

    if ! eval test -z "\"\${$1##*:$2:*}\"" -o -z "\"\${$1%%*:$2}\"" -o -z "\"\${$1##$2:*}\"" -o -z "\"\${$1##$2}\""
    then
        eval "export $1=\$$1:$2"
    fi
}

# add to front of path
prepend_path()
{
    if eval test -z "\$$1"
    then
      eval "export $1=$2"
      return
    fi

    if ! eval test -z "\"\${$1##*:$2:*}\"" -o -z "\"\${$1%%*:$2}\"" -o -z "\"\${$1##$2:*}\"" -o -z "\"\${$1##$2}\""
    then
      eval "export $1=$2:\$$1"
    fi
}

prepend_path_if_exists()
{
    if [ -d "$2" ]
    then
        prepend_path $1 $2
    fi
}

###################################################
### PATH-type list variables
###################################################

prepend_path PATH /usr/local/bin
prepend_path PATH $HOME/usr/bin
prepend_path PATH $HOME/bin
for i in $HOME/opt/*/bin
do
    prepend_path_if_exists PATH $i
done
prepend_path_if_exists PATH $HOME/opt/android-sdk-linux_x86-1.0_r2

append_path PYTHONPATH $HOME/.python

append_path LD_LIBRARY_PATH $HOME/lib:$HOME/usr/lib
prepend_path_if_exists LD_LIBRARY_PATH $HOME/opt/vtk-4.4.2/lib/vtk
prepend_path_if_exists LD_LIBRARY_PATH $HOME/opt/glew-1.3.4/lib

###################################################
### Simple variables
###################################################

if [ -z "$HOST" ]
then
    HOST=$(hostname | sed 's/\..*//')
fi

export CVSROOT="####"
export CVS_RSH=ssh

export EDITOR=vim
export VISUAL=vim

export LC_COLLATE="POSIX"
export PV_INTERFACE_PATH=$HOME/src/paraview-xml

if [ "$TERM" == "xterm" ]
then
    export TERM="xterm-color"
fi

# Stolen from Gentoo:
PS1="\[\033[01;32m\]\u@\h\[\033[01;34m\] \w \$\[\033[00m\] "

###################################################
### Aliases
###################################################

alias cvstat='cvs status | fgrep "File:" | fgrep -v Up-to-date'
alias mpirun='mpirun -machinefile ~/.mpi-hosts'
alias mv='mv -iv'
alias cp='cp -iv'
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'
alias rgrep='rgrep --color=auto'

###################################################
### Platform- or system-specific modifications
###################################################

if [ "$(uname -s)" == "Darwin" ]; then
    # Mac OS X stuff:
    alias ls='ls -AFGq'
    append_path PYTHONPATH ~/Library/Python
    prepend_path PATH /opt/ibmcmp/xlf/8.1/bin
    # Is it 1978 in Cupertino?
    stty erase ^?
    # XTerm's $MANPATH gets messed up, and I can't find where it's happening.
    # Screw it. Just reset the whole thing, cuz the default works.
    unset MANPATH
else
    alias ls='ls -FHq --color=auto'
fi

# On Patheon cluster, set slave node to local display:
if [ ! -z $(expr "$HOST" : '\(pantheon-red[1-9]\)') ]
then
    export DISPLAY=:0.0
fi
